// ACTUAL BLANK FIELD FOR REAL USAGE
var field = [
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N']
			];
		

//Experimental field for testing purposes
/*
var field = [
				['I', 'I', 'I', 'I', 'I', 'I', 'I', 'I', 'I', 'Z'],
				['I', 'I', 'Z', 'Z', 'Z', 'Z', 'I', 'I', 'I', 'Z'],
				['I', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'N', 'Z'],
				['I', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'N', 'N'],
				['I', 'I', 'I', 'I', 'I', 'I', 'I', 'I', 'I', 'I'],
				['N', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'Z', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'Z', 'Z', 'Z', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'Z'],
				['N', 'N', 'N', 'N', 'N', 'I', 'N', 'N', 'N', 'Z'],
				['Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z', 'Z'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'Z', 'Z'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'Z', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'Z', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'Z', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'],
				['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N']
			];

*/
			
var fieldRow = ['N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N', 'N'];			

var startLine = 23;
var killLine = 25;
var startPos = 5;

var translateI;
var translateJ;

var removalList = [];
var activeTetromino;
var tracking = false;

const I_TRANSLATION = 0;
const J_TRANSLATION = 1;
const ROTATE_CLOCKWISE = 0;
const ROTATE_C_CLOCKWISE = 1;

function activateTetromino(tetro) {
	activeTetromino = tetro;
	tracking = true;
	
	translateJ = startLine;
	translateI = startPos;
}

function insertTetromino() {
	field[translateJ - activeTetromino.p1.j][translateI - activeTetromino.p1.i] = activeTetromino.drawChar;
	field[translateJ - activeTetromino.p2.j][translateI - activeTetromino.p2.i] = activeTetromino.drawChar;
	field[translateJ - activeTetromino.p3.j][translateI - activeTetromino.p3.i] = activeTetromino.drawChar;
	field[translateJ - activeTetromino.p4.j][translateI - activeTetromino.p4.i] = activeTetromino.drawChar;	
}

function translateTetromino(direction, shift) {
	floatTetromino();
	
	switch(direction) {
		case I_TRANSLATION:
			translateI += shift;
			break;
		case J_TRANSLATION:
			translateJ += shift;
			break;
	}
	
	anchorTetromino();
	
}

function rotateTetromino(direction) {
	floatTetromino();
	
	switch(direction) {
		case ROTATE_CLOCKWISE:
			activeTetromino.advanceState();
			break;
		case ROTATE_C_CLOCKWISE:
			activeTetromino.retreatState();
			break;
	}
	
	anchorTetromino();
}

function floatTetromino() {
	field[translateJ - activeTetromino.p1.j][translateI - activeTetromino.p1.i] = 'N';
	field[translateJ - activeTetromino.p2.j][translateI - activeTetromino.p2.i] = 'N';
	field[translateJ - activeTetromino.p3.j][translateI - activeTetromino.p3.i] = 'N';
	field[translateJ - activeTetromino.p4.j][translateI - activeTetromino.p4.i] = 'N';
}

function anchorTetromino() {
	field[translateJ - activeTetromino.p1.j][translateI - activeTetromino.p1.i] = activeTetromino.drawChar;
	field[translateJ - activeTetromino.p2.j][translateI - activeTetromino.p2.i] = activeTetromino.drawChar;
	field[translateJ - activeTetromino.p3.j][translateI - activeTetromino.p3.i] = activeTetromino.drawChar;
	field[translateJ - activeTetromino.p4.j][translateI - activeTetromino.p4.i] = activeTetromino.drawChar;	
}

function validMove() {
	
}

function releaseTetromino() {
	activeTetronimo = null;
	tracking = false;
}

function scanField() {
	for(i = 0; i < field.length; i++) {
		if(scanLine(i)) {
			removalList[removalList.length] = i;
		}
	}
}

function scanLine(i) {
	var complete = true;
	for(j = 0; j < field[i].length; j++) {
		complete &= (field[i][j] != 'N') ? true : false ;
	}
	
	return complete;
}

function removeLines() {
	removalList.sort(function(a, b){return a - b});
	var ptr = removalList.length - 1;
	for(i = 0; i < removalList.length; i++) {
		removeLine(removalList[ptr--]);
	}
	removalList = [];
}

function removeLine(x) {
	for(j = x; j < field.length - 1; j++) {
		field[j] = field[j + 1].slice();
	}
}
	
	